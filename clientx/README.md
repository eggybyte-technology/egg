# egg/clientx

## Overview

`clientx` provides a production-grade HTTP client layer for Connect-based services. It includes retry with exponential backoff, optional circuit breaker, request timeouts, and an idempotency key helper. A small generic helper is available to construct typed Connect clients.

## Key Features

- Exponential backoff retries for transient 5xx errors
- Optional circuit breaker to prevent cascading failures
- Request timeouts per client
- Idempotency key injection for safe retries
- Generic helper to construct typed Connect clients

## Dependencies

Layer: L3 (Runtime & Communication)

Depends on: `core` (log), `connectx` (optional)

## Installation

```bash
go get github.com/eggybyte-technology/egg/clientx@latest
```

## Basic Usage

```go
import (
    "time"
    "github.com/eggybyte-technology/egg/clientx"
)

// Create an HTTP client with retry, timeout, and circuit breaker
client := clientx.NewHTTPClient("https://api.example.com",
    clientx.WithTimeout(5*time.Second),
    clientx.WithRetry(3),
    clientx.WithCircuitBreaker(true),
)

// Use for Connect RPC clients
// greeter := greeterv1connect.NewGreeterServiceClient(client, "https://api.example.com")
```

### Construct a typed Connect client

```go
// newClient is a constructor generated by Connect for your service
svc := clientx.NewConnectClient("https://api.example.com", "greeter",
    greeterv1connect.NewGreeterServiceClient,
    clientx.WithTimeout(5*time.Second),
)
```

## Configuration Options

| Option             | Type           | Description                                     |
| ------------------ | -------------- | ----------------------------------------------- |
| `Timeout`          | `time.Duration`| Per-request timeout                             |
| `MaxRetries`       | `int`          | Max retry attempts on transient errors          |
| `RetryBackoff`     | `time.Duration`| Initial backoff (exponential)                   |
| `EnableCircuit`    | `bool`         | Enable circuit breaker                          |
| `CircuitThreshold` | `uint32`       | Consecutive failure threshold for breaker       |
| `IdempotencyKey`   | `string`       | Header name for idempotency key                 |

## Stability

Stable since v0.1.0.

## License

This package is part of the EggyByte framework and is licensed under the MIT License. See the root LICENSE file for details.

---

 

